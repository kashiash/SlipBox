> Hey there guys, the NetworkBurger here, hope you've been doing well. Lately I've been thinking a lot about network security on our routers. This video will be covering device harning on a MicroTik running RouterOS version 7. We'll be looking at some base practices when it comes to securing our network and routers and how to prevent unauthorized access to the devices. So let's get into the video. 



> The first step to hardening any device is to change the default login details. It's very important because this is the biggest attack vector for any network really. The moment you have that basic admin account and a very, very basic password, somebody's going to figure it out and log into that device. So let's change those details. So let me just quickly log on to Winbox. So I'll just do this from my Linux machine. And a lot of people ask me, "Hey, how do you actually access Winbox on Linux?" And you use an application called Wine to just emulate the actual Winbox application like it was on Windows. So let's connect onto our MicroTik device. Once I've connected, let's just max the screen out a bit. And let's look at our login details. So if I go into my system users, we can see a list of user accounts that have been configured that can gain access to this router. And there's a various different other things we also check here. But the first and foremost thing is we want to first create a new administrator account, this default one we are not just going to delete, but we are going to disable it. So first click on the plus, create your new account, give it a unique name, I'll make mine the network Berg. The group, I will put it in the same group as the normal admin account, full access, which means it can do everything that the admin account can do. Then we can set our password, try and make this something strong, the more characters you have and the more secret or different types of characters you use like numerics or special characters, stronger the password is. I'm just going to make this a very basic password that I tend to use in my lab that I shouldn't, but this is just for demonstration purposes. So let's apply this change and once this has been done, next step is actually logging back onto the router with your new account to verify that it works before you disable your admin account. So let's just log out here and then once I've logged out, I can log back in with my newly created account with its password and we can verify that we can log in. Now that that's been done, it's as easy as just disabling the admin account so that somebody can't use it as an attack vector to try and log into your device. So step one, done. 





Pierwszym krokiem w zabezpieczaniu dowolnego urządzenia jest zmiana domyślnych danych logowania. To bardzo ważne, ponieważ stanowią one największy wektor ataku dla każdej sieci. W momencie, gdy masz domyślne konto administratora i bardzo proste hasło, ktoś może to wykorzystać, żeby uzyskać dostęp do urządzenia. Dlatego zmieńmy te dane logowania. Pozwól mi teraz szybko zalogować się do Winboxa. Zrobię to z mojego komputera z systemem Linux. Wielu ludzi pyta mnie, "Hej, jak można uzyskać dostęp do Winboxa na Linuxie?" I używa się aplikacji o nazwie Wine, aby emulować aplikację Winbox, tak jakby działała na systemie Windows. Teraz połączmy się z naszym urządzeniem MicroTik. Gdy się zaloguję, powiększmy trochę ekran. Spójrzmy na nasze dane logowania. Jeśli wejdę w użytkownicy systemu, zobaczymy listę kont użytkowników, które zostały skonfigurowane do uzyskania dostępu do tego routera. Istnieje wiele innych rzeczy, które również można tutaj sprawdzić. Ale przede wszystkim chcemy najpierw stworzyć nowe konto administratora. To domyślne konto nie zostanie usunięte, ale zostanie wyłączone. Więc kliknijmy najpierw plus, stwórzmy nowe konto, nadajmy mu unikalną nazwę. Ja nazwę je "network Berg". Grupa, do której przypiszemy to konto, będzie taka sama jak dla standardowego konta administratora, co oznacza pełny dostęp, czyli będzie mogło wykonywać wszystkie czynności, które może wykonywać konto administratora. Następnie możemy ustawić hasło. Starajmy się, aby było ono silne, im więcej znaków i różnych rodzajów znaków, takich jak cyfry czy znaki specjalne, tym silniejsze jest hasło. Ja jednak utworzę bardzo proste hasło, które często używam w swoim laboratorium, choć nie powinienem. To tylko w celach demonstracyjnych. Teraz zastosujmy tę zmianę. Gdy to zostanie zrobione, następnym krokiem jest zalogowanie się ponownie do routera za pomocą nowego konta, żeby sprawdzić, czy działa, zanim wyłączymy konto administratora. Więc wylogujmy się teraz, a kiedy już się wyloguję, będę mógł zalogować się ponownie przy użyciu nowo utworzonego konta i jego hasła, żeby sprawdzić, czy możemy się zalogować. Teraz, kiedy to zostało zrobione, wystarczy tylko wyłączyć konto administratora, żeby nikt nie mógł go wykorzystać jako wektor ataku, próbując się zalogować do urządzenia. Pierwszy krok zrobiony.

> So second step would be for us to actually make use of the powerful built-in firewall that comes with RouterOS. Now you can use this for a myriad different reasons, but what we're going to be focusing on is just how to set chains that will be blocking administration access to our router so that we can drop any traffic that we don't want to get onto it. You can also maybe implement some basic firewall rules so that people that's sitting behind the router when they go to the internet they can only make use of certain ports and protocols instead of everything just being open. But this is more of a choice of how you want to set up your rules. I'm just going to give you very basic examples and just quickly run through how to configure your firewall rules. So let's configure a couple of rules. And this we can do by just going into the IP firewall settings. So you can access the firewall either by going into IP firewall, or if you're using IPv6, you can go to IPv6 and then firewall, how it all functions works exactly the same, it's just different TCP versions. I'm going to stick to on version four, which people like to call the legacy IP. So I will just go into IP firewall. And then from here, we get faulter rules where we can in essence enforce rules to allow or deny access on the router or through the router which is very powerful. So to add a new rule you can just click on the little plus and then from your chains you can select either the forward, input or output chains. Now forward will mean any traffic that's passing through the router, through the MikroTik. So let's say this might be a computer that's sitting behind in your network that uses the MikroTik as its gateway. And then if the MikroTik needs to forward the traffic onto, let's say, the intranet, that will count as a forward chain. Whereas the input chain will be where the destination is the MikroTik itself. The MikroTik is the end point. And the output is obviously going to be the opposite, whereas the MikroTik is the originator of the traffic, because maybe you don't want the MikroTik to do specific stuff, so you can just drop it on its output chains, which is really cool. 



Now we will first just use the input chain to maybe restrict access on management on our WAN port because we don't want anybody to just be able to connect to it. So what we could also select here is our in interface could be my ether1 which is my WAN port and then I can do something like a source address where we can specify which sources we're going to be looking for and you can even invert this source where you can say anything that isn't part of that source, you must drop or allow. Now, there's another thing that I want to do before we actually apply this rule, and that is create an address list because address lists are awesome. They allow you to group different host names and IPs together into a certain list. And then you can reference that whole list so that you can have a single rule for multiple IPs or hosts, instead of having, you know, multiple different rules, it just makes a lot of sense. So let's quickly create an address list as well. So in firewall, I can just go to address list, I see I've already created them. So let's just delete these quickly and recreate, we can give it a name like MGMT ranges. And then the first range I will make this is my LAN subnet, which people can use to connect to this router. And then maybe my management network this I'm going to make my virtual network that I'm using to connect to these devices. But this could could be your own management network as well if you do have something like that. So let me just apply this. Now you'll see we have two addresses or two networks that's being referenced as management ranges. So if I go back to the firewall rule, I can now specify the source address list. So I can say this source address list, I only want to either allow access. But what I like about the inverted rule is when you click on this, you can say anything that isn't my management ranges. If I go to the action and I reject this, I can now send the message back to people that aren't a part of that range. When they try and connect, they'll get an error and they won't be able to get in. So let's just hit apply. So that is just a very basic rule to allow specific access on our management interfaces. How about we also add some rules for our LAN network so that only certain stuff in the LAN can get to the internet. So you don't have access to everything, so you can't go onto those torrenting sites and whatever. So what you could do as well, just very basically, we can add something like a LAN range. And then I can just reference the single LAN range now. So 172.16.0.0/24. Let's just fix that up. And then what I could do is I can just add a new rule, and I can say anything from our LAN range on TCP. and then I can specify the ports as well. So I could say, people will have access to port 80, port 443, port 8080 maybe, and even 53 for DNS on TCP. And our out interface is going to be our WAN interface. And the action I can just leave this on as except. And I'm just going to double click this rule, copy it quickly, and then it has all of the details in it already. However, I might allow some UDP stuff as well. And here I might allow 53 since DNS also uses port 53 for it. So I will still apply that. I'll hit OK. And you'll notice as I add these rules, they're being added in a sequential manner. And that is very relevant because the firewall does read rules from top to bottom. And the moment it finds a match, it will do whatever it needs to do and it will stop anything else after that. So if you accidentally make a rule where you want to allow stuff but it's behind or below a deny any rule, then that rule is just not going to work. I'll give you an example of it just now. So let's quickly just add one last rule where we say we want to drop any traffic. So forward and now from here we can say anything else that's going out over ether1, we're just going to reject that. Very basic. So here's actually a good test because right now I'm just allowing some browsing and DNS traffic but I'm not even allowing ping ICMP. So from this Linux machine it's actually using this micro-tick as its default gateway. Let's see if I can do a ping to www.google.com and here I can see I get a destination host net unreachable because it's that error message that that we specified in our rule. Now, how do I fix this? Well, I can just add a new firewall rule. So let's add the firewall rule, go back to the general tab. Then I can just specify my source address list again. You could also just type the range out if you'd like. So your source address 172.16.0.0/24. And then my protocol, I'm going to allow ICMP. And my out interface, I'm going to set this as my ether one because this is traffic going over my WAN network. I will then set this to accept, which it does by default. Hit Apply. And now we have another firewall rule. Let's quickly see if we can ping now. We see we still get the error, but we get the error because of the sequences I mentioned. So I just need to push this up by dragging and dropping it above the reject rule. So once I do that, now I have a rule that will now allow ICMP as well from the LAN network. So if I go back, let's see if I can ping out now. ping www.google and we see the ping response. Great, so this is just a basic way that we can set up some firewall rules. Please look at the pinned comment. I will link a video where I go more in details of how the firewall rules function, but this is a great start to hardening our device as well. Another thing that we can do just to get the most out of securing our devices is to disable insecure or unsecure protocols. This means stuff like FTP or Telnet that works in clear text. So whenever you want to access the router, it should only be on secure protocols like SFTP or SSH. So let's do that. So let's change how we access this router so we can disable unsecure protocols like FTP and Telnet, and we can only allow the more secure protocols like SSH and maybe Winbox even. So let's go into our IP services. And then from IP services, it will give you a list of all of the management ports that the router currently uses and exposes. And we can now disable anything that we don't want. So I could select the API stuff I rarely use, FTP I'm not going to use, Telnet, we don't want that. And I'm holding the control to select additional stuff I don't want to have, and also Webfig I don't want to have. So www, I'm going to disable that. I can just click on the cross, and there we go. Now I've disabled services that we don't need. We can also use IP services to change the ports the router uses for management, as well as setting specific available from addresses, so that only specific networks or subnets can access the router on those management ports. So let's do that on IP services as well. So from here, all that I need to actually do is find the protocol or port that I want to perhaps update. So for SSH, I might double click on this. And now I can set the port to something else, maybe I want to set it to 2202 because I know bad actors will most likely be scanning port 22 but 2202 might not be on everybody's radar. So this is just another added bit of security. And if we want to set available from addresses, it's as easy as just clicking on available from and now you can specify the sources that you would like to have access on this port. So for SSH, I might want to allow 172.16.0.0/24, which is the LAN network of this microtech. And then maybe my management network, which is 192.168.149.0/24 in my case. If I want to add anything new, it's literally just clicking on this drop down arrow and it will add a new item. And if you want to remove something, just click on the arrow going up. That's it. So once I click on apply, now I should be able to access this microTIC on SSH on port 2202. Let's just set the allowed from address for Winbox as well. So I'm going to leave the port for Winbox the same, but you could change the port for Winbox to something else. But let's just leave it as it is right now and I can add 192.168.0.149.0/24 my management network and then 172.16.0.0/24 my LAN network. I'm applying this and now that that's been applied now I should be able to access the device. Let's just quickly test SSH. So let me just quickly see if I can SSH on opening up a new window and what I can do is SSH the network which is the user that I created at and then the IP address of the router. So I will connect onto its LAN IP now. And then let's just, let's just try and connect just like this. See what happens. Oh, we got a connection refused because we know that we've changed the port. So let me just specify that I want to connect on port 2202. And hey, we see we get a response. I can say yes, I want to connect. Let's put in my password. So now we've even secured our network even more by changing our default management ports. and disabling the stuff we don't need and setting allowed from addresses. For an additional layer of security, what else we could potentially do is add SSH keys that will be required whenever a user authenticates. So if they don't have the corresponding SSH key, they won't be able to get onto the microTIK. And, you know, even if they know what the password is, it won't work. So let's also implement SSH keys into the equation. Now to do this, this should be pretty straightforward. just a few things I want to show you regarding the SSH keys. If I open up a terminal window on Winbox and I do something like "ipssh print", we can see what the host key size is, which is going to be important because we're going to need to encrypt our key in this size. So I'm just going to use my Linux host to generate SSH keys. However, you could use something like a putty key generator on Windows to do the same, but I'm just going to head into my terminal quickly and then I can do something like ssh-keygen -t rsa -b for the bit size 2048. When I hit enter it will create a new public private RSA key pair for us. We can set it for the default directory. If you want to store it somewhere else that's up to you but I'll just store it where it currently is. I see I've already got one but let's just overwrite it and we're not using any passphrase. So now that we've generated our SSH key pair, I need to upload the public key to my MikroTik. How do I do this? Well, in theory, you should just be able to drag and drop the file from wherever it's saved into the file system and that should work fine. Although I have some issues that whenever I do that using wine, it drops the winbox connection. So if you're doing this from Windows, it will definitely work a lot better. But what I'm going to be doing is just using an application on Linux, namely curl, so that I can upload this file. So I'll just do a curl minus T, because I want to upload something, and then I need to specify what I want to upload. Now I know it is in my home directory, it is the networkberg.ssh.ssh/ and then the ID_RSA.pub, the public key file. That's what I want to copy. Now I need to specify my SFTP details. Now, since I know I've disabled FTP, I need to use SFTP. So I'll specify SFTP colon forward slash forward slash, then the IP address of my router. And then I also need to specify my port as 2202 since I've changed the default SSH port. Now that that's been done, I can also specify user and then I need to set my username and password. So in my case, it is going to be the network Berg colon and then my password. Once I hit OK, it's uploaded the file to the micro tick I can see in the file system that it created something. And there we can see an SSH key has been created. Great. Now we can actually use this SSH key with one of our users in order to grant access with the key. And what's cool about this is once you've installed it, you know, you no longer need to use the password to actually connect to the micro tick. So let me show you how easy this is. So we can just go into our system, we can go into our users, we can go into SSH keys, we can import SSH key. Now we need to specify which user we want to do this for. So this will be for the network Berg. And then the key file will be that ID underscore RSA dot pub that we just created. We didn't use any passphrase. So once I hit import SSH key, that key has now been added for the network burg user, which is awesome, because this means I should be able to connect onto this micro tick now. So let me just log out quickly. Actually, I'm still even logged out. So let's just try an SSH back in. So if I do an SSH as the network, burg, at 192, or actually 172 16 zero dot one on port 2202, I just get prompted into the micro tick automatically. So this is super secure and this is also a lot easier and quicker to just get back onto your devices again. So this next point is a bit tricky because we also need to maybe consider how we want to manage our devices and I can highly suggest using something like VPN tunnels to connect to the device for management purposes. Now you could use anything like L2TP with IPsec, you could use WireGuard, or if you have a newer MicroTik you can even use ZeroTier. Now I will put links in the description or the pinned comment for all three types of setups. So you can pick and choose whatever one you want. Just please take note of when you do go the VPN management route, just add your VPN ranges in the allowed from addresses as well. And then you'll be able to manage your micro tick over a VPN tunnel as well. And this will also give you so much added security. And now the final thing that we need to cover that will definitely make sure that your router is practically as as secure as it can be, is performing maintenance in the form of upgrading your firmware whenever required. Because let's face it, many times new attack vectors open up, the bad actors figure out a new way how to access the system. And this is where suppliers will definitely make some type of security patch that they'll install inside an update of their OS, like router OS, and it will fix whatever vulnerability there was. So let's look at how we can just upgrade our firmware. Now to do this, this is actually very straightforward, you can just go into your system packages. And then from your packages, you can do a check for updates. And then if you have internet access, you can search for stuff like the stable build is definitely one of the bulge you want to look at long term, I don't think there's anything new for version 7 that they've considered long term yet. But if you look at stable you'll find I'm currently on the latest build but if any new builds get updated it will show you what the latest version is and if you do check for update it will obviously check for that and you will have the option to download or download and install. Now I'll give you an example of that by just going to the development channel quickly you can see there is a 7.7 RC5 and here we have a download and download and install. So what do these buttons mean? Well, download will just download the package file into your file system. So it gets saved in files, you'll see that the package is here. And then when you restart the micro tick, it will boot up and then install the new software that way. Otherwise, when you do download and install, it will just automatically reboot the micro tick, and it will boot up with the latest build. So that is one thing that we need to make sure of that we keep updated. And the other thing that we need to do is also just check our system and router board. But when you go to that router board, there's also actually a firmware section that you can go into and it's the same process. You can actually update the firmware from there just to make sure that your device has the latest firmware. But this router board update is more of a hardware update which will typically fix stuff like broken NICs and SFP modules not being picked up properly or some hardware fault. The software itself, when also comes to security patches this is where your router OS package comes into play. So if you followed all of these steps then your device is going to be fairly secure and you don't really need to worry too much about bad actors getting into it. And that's it! So easy to follow this practice and I hope I've shown you a couple of things. Feel free to let me know if there's additional things that you do whenever it comes to device security or hardening on your own network I'll catch you guys in the next video. I'd like to also just thank my YouTube and Patreon members that help support the channel and obviously you the viewer. I also just want to remind everybody to subscribe to the channel if you're not subscribed already. It really does help me a little bit with my videos gaining some traction. So thanks so much and I'll see you guys soon. Bye Bye. [Music]